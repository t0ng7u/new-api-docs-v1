---
title: Model Ratio Synchronization Module
---

<Callout type="info" title="Feature Description">
The API prefix is uniformly http(s)://`<your-domain>`
</Callout>

    HTTPS should be used in production environments to ensure authentication tokens. HTTP is only recommended for development environments.

    An advanced feature specifically for model pricing synchronization. It supports concurrently fetching ratio configurations from multiple upstream sources, automatically recognizing different interface formats, and providing data credibility assessment. Primarily used for bulk updating model pricing information.

## ğŸ” Root Authentication

### Get Synchronizable Channel List

- **Interface Name**: Get Synchronizable Channel List
- **HTTP Method**: GET
- **Path**: `/api/ratio_sync/channels`
- **Authentication Requirement**: Root
- **Feature Description**: Retrieves a list of all channels in the system that can be used for ratio synchronization, including channels with valid BaseURLs and official presets.

ğŸ’¡ Request Example:

```
const response = await fetch('/api/ratio_sync/channels', {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer your_root_token',
    'New-Api-User': 'your_user_id'
  }
});
const data = await response.json();
```

âœ… Successful Response Example:

```
{
  "success": true,
  "message": "",
  "data": [
    {
      "id": 1,
      "name": "OpenAIå®˜æ–¹",
      "base_url": "https://api.openai.com",
      "status": 1
    },
    {
      "id": 2,
      "name": "Claude API",
      "base_url": "https://api.anthropic.com",
      "status": 1
    },
    {
      "id": -100,
      "name": "å®˜æ–¹å€ç‡é¢„è®¾",
      "base_url": "https://basellm.github.io",
      "status": 1
    }
  ]
}
```

â— Failed Response Example:

```
{
  "success": false,
  "message": "è·å–æ¸ é“åˆ—è¡¨å¤±è´¥"
}
```

ğŸ§¾ Field Description:

- `data` (array): List of synchronizable channels
  - `id` (number): Channel ID, -100 for official preset
  - `name` (string): Channel name
  - `base_url` (string): Channel base URL
  - `status` (number): Channel status, 1=enabled

### Fetch Ratios from Upstream

- **Interface Name**: Fetch Ratios from Upstream
- **HTTP Method**: POST
- **Path**: `/api/ratio_sync/fetch`
- **Authentication Requirement**: Root
- **Feature Description**: Fetches model ratio configurations from specified upstream channels or custom URLs, supporting concurrent retrieval and differential comparison.

ğŸ’¡ Request Example (by Channel ID):

```
const response = await fetch('/api/ratio_sync/fetch', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer your_root_token',
    'New-Api-User': 'your_user_id'
  },
  body: JSON.stringify({
    channel_ids: [1, 2, -100],
    timeout: 10
  })
});
const data = await response.json();
```

ğŸ’¡ Request Example (by Custom URL):

```
const response = await fetch('/api/ratio_sync/fetch', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer your_root_token',
    'New-Api-User': 'your_user_id'
  },
  body: JSON.stringify({
    upstreams: [
      {
        name: "è‡ªå®šä¹‰æº",
        base_url: "https://example.com",
        endpoint: "/api/ratio_config"
      }
    ],
    timeout: 15
  })
});
const data = await response.json();
```

âœ… Successful Response Example:

```
{
  "success": true,
  "data": {
    "differences": {
      "gpt-4": {
        "model_ratio": {
          "current": 15.0,
          "upstreams": {
            "OpenAIå®˜æ–¹(1)": 20.0,
            "å®˜æ–¹å€ç‡é¢„è®¾(-100)": "same"
          },
          "confidence": {
            "OpenAIå®˜æ–¹(1)": true,
            "å®˜æ–¹å€ç‡é¢„è®¾(-100)": true
          }
        }
      },
      "claude-3-sonnet": {
        "model_price": {
          "current": null,
          "upstreams": {
            "Claude API(2)": 0.003
          },
          "confidence": {
            "Claude API(2)": true
          }
        }
      }
    },
    "test_results": [
      {
        "name": "OpenAIå®˜æ–¹(1)",
        "status": "success"
      },
      {
        "name": "Claude API(2)",
        "status": "error",
        "error": "è¿æ¥è¶…æ—¶"
      }
    ]
  }
}
```

â— Failed Response Example:

```
{
  "success": false,
  "message": "æ— æœ‰æ•ˆä¸Šæ¸¸æ¸ é“"
}
```

ğŸ§¾ Field Description:

- `channel_ids` (array): List of channel IDs to synchronize, optional
- `upstreams` (array): List of custom upstream configurations, optional
  - `name` (string): Upstream name
  - `base_url` (string): Base URL, must start with http
  - `endpoint` (string): Interface endpoint, defaults to "/api/ratio_config"

- `timeout` (number): Request timeout (seconds), defaults to 10 seconds
- `differences` (object): Differential ratio comparison results
  - Keys are model names, values contain difference information for each ratio type
  - `current`: Current local value
  - `upstreams`: Values from each upstream, "same" indicates identical to local
  - `confidence`: Data credibility, false indicates potentially unreliable

- `test_results` (array): Test results for each upstream